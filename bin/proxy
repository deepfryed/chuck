#!/usr/bin/env ruby

$:.unshift File.dirname(__FILE__) + '/../lib'
require 'options_parser'
require 'proxy'
require 'swift/migrations'

options = OptionsParser.new(ARGV).options

if options[:help]
  puts <<-EOM

    #{$0} [options]

    --profile file
    --host    host  # proxy host, default 0.0.0.0
    --port    port  # proxy port, default 9889
    --help

  EOM
  exit
end

Swift.setup(:default, Swift::DB::Sqlite3, db: ':memory:')
Swift.migrate!

$stdout.sync = true
$stderr.sync = true
Proxy::Server.new(options).start
